(function(j,f){if(typeof define==="function"&&define.amd)define(f);else j.viewport=f()})(this,function(){function j(){var a={width:q(),height:g.clientHeight};n={width:a.width,height:a.height};a=0;for(var b=h.length;a<b;a++)h[a].state.subscribers&&h[a].update.call(h[a])}function f(){clearTimeout(o);o=setTimeout(function(){l||(l=true);j()},100)}function i(a,b){return function(){return b.apply(a,arguments)}}function r(a){return function(){var b=true,c=true,d=true,e=true,k=n;if(a.width){b=k.width>=a.width[0];
c=a.width[1]?k.width<=a.width[1]:true}if(a.height){d=k.height>=a.height[0];e=a.height[1]?k.height<=a.height[1]:true}return b&&c&&d&&e&&true}}function p(a){this.vps={};this.viewports=a;this.state={};this.state.channels={};this.state.tokenUid=-1;this.state.subscribers={};this.state.previous=m;this.state.present=m;this.state.initialUpdate=true;a=0;for(var b=this.viewports.length;a<b;a++){var c=this.viewports[a];this.vps[c.name]=c;this.vps[c.name].test=r(c)}return this}var o,g=document.documentElement,
l=false,n={width:0,height:0},m={name:"",width:[],height:[]},h=[],q=function(){var a,b,c=document.head||document.getElementsByTagName("head")[0],d=function(){return window.innerWidth},e=function(){return g.clientWidth};if(window.innerWidth===undefined)a=e;else{b=document.createElement("body");b.style.cssText="overflow:scroll";a=document.createElement("div");a.id="viewportjs-div-test-element";a.style.cssText="position:absolute;top:-1000px;";a.innerHTML=["<style>","@media( width:"+g.clientWidth+"px ) {",
"#viewportjs-div-test-element {width:10px !important}}</style>"].join("");b.appendChild(a);g.insertBefore(b,c);a=a.offsetWidth===10?e:d;g.removeChild(b)}return a}();p.prototype={is:function(a){return this.current().name===a},current:function(){for(var a=m,b=0,c=this.viewports.length;b<c;b++){var d=this.viewports[b],e=d.name;if(this.vps[e])if(this.vps[e].test())a=d}return a},matches:function(a){return this.vps[a]&&this.vps[a].test()},subscribe:function(a,b){if(!(a in this.vps)&&a!=="*")throw Error('The viewport "'+
a+'" does not match any configured viewports.');this.state.tokenUid+=1;this.state.channels[a]||(this.state.channels[a]=[]);this.state.channels[a].push({token:this.state.tokenUid,method:b});a===this.state.present.name&&b(true,this.state.present);a==="*"&&b(this.state.present);return this.state.tokenUid},unsubscribe:function(a){var b,c;for(c in this.state.channels)if(b=this.state.channels[c])for(var d=0,e=b.length;d<e;d++)b[d].token===a&&b.splice(d,1)},publish:function(a,b){var c=this.state.channels[a],
d=c?c.length:0;if(c)for(;d--;)a==="*"?c[d].method(this.state.present):c[d].method(b,this.vps[a])},update:function(){if(this.state.initialUpdate||l){if(this.state.initialUpdate)this.state.initialUpdate=false;this.state.previous=this.state.present;this.state.present=this.current()}if(this.state.present!==this.state.previous){this.publish(this.state.previous.name,false);this.publish(this.state.present.name,true);this.publish("*")}}};if("addEventListener"in window){window.addEventListener("resize",f);
window.addEventListener("orientationchange",f)}else window.attachEvent("onresize",f);j();return function(a){a=new p(a);h.push(a);a.update();return{vps:a.vps,viewports:a.viewports,is:i(a,a.is),current:i(a,a.current),matches:i(a,a.matches),subscribe:i(a,a.subscribe),unsubscribe:i(a,a.unsubscribe)}}});
